# HEPWALTER

## Searching candidate function from command line
### Command for directly grepping function names
`sudo objdump -CT /proc/449844/root/usr/local/openresty/nginx/sbin/nginx | grep ngx_http_write`


End to End Steps
1. Get microservice of interest running on Node 0
2. Confirm the singular container is running using "sudo docker stats"
3. Follow the following customized perf_chains instructions
  a.) Use "sudo docker stats" to get container ID
  b.) Use "docker inspect --format '{{.State.Pid}}' <container-id>" to extract PID
  c.) "sudo perf record -j any_call,any_ret -p <microservice_pid> -- sleep <time_in_seconds>"
  d.) Place resulting perf.data into perf_chains/ directory
  e.) Use "sudo chmod +x setup.sh" to install all necessary setup.
  f.) Update path accordingly in symbolizer.py
  g.) "sudo chmod +rx perf.data" to set permissions.
  h.) Generate proto file using "sudo perf_converter -i perf.data -o perf.proto -O proto".
  i.) Recompile proto using "protoc --python_out=. ./profile.proto
                             protoc --python_out=. ./perf_data.proto"
  j.) "sudo python3 print_candidate_functions.py" to extract candidate functions
  k.) "sudo python3 print_candidate_functions.py > <container_name>.txt" to write candidate function
4. Follow the following instructions to generate customized BPFtrace script
  a.) Replace "container_name" in prepare.py with container name of interest.
  b.) Gather container ID with "sudo docker stats"
  c.) Type "sudo docker exec -it <container_ID> /bin/bash" to enter into container
  d.) Use "top" and find the process with highest CPU utilization. Then type "which <binary>" to gather the binary
  e.) Copy and paste this path into the "binary" from prepare.py
5. Replace "Source" and "Destination" in prepare.py with candidate functions from <container_name>.txt. Ideally, choose a function that belongs under encryption, compression, or serialization (data center tax)
6. Run "python3 prepare.py", this generates a `final_run_again.bt` file for bpftrace
7. The main.py is a script to execute the prepare.py and use BPFGrep to capture the outputs generated by bpftrace
8. The main function of main.py has three major variables: `iterations` `duration` `lost_threshold`
